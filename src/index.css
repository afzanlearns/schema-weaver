@import url("https://fonts.googleapis.com/css2?family=Geist:wght@400;500;600;700;800&display=swap");
@import url("https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap");
@tailwind base;
@tailwind components;
@tailwind utilities;

/* Definition of the design system. All colors, gradients, fonts, etc should be defined here. 
All colors MUST be HSL.
*/

@layer base {
  :root {
    --background: 209 40% 96%;
    --foreground: 222 47% 11%;

    --card: 210 40% 98%;
    --card-foreground: 222 47% 11%;

    --popover: 214 31% 91%;
    --popover-foreground: 222 47% 11%;

    --primary: 216 19% 26%;
    --primary-foreground: 210 19% 98%;

    --secondary: 215 19% 34%;
    --secondary-foreground: 210 40% 98%;

    --muted: 215 20% 65%;
    --muted-foreground: 222 47% 11%;

    --accent: 210 40% 98%;
    --accent-foreground: 215 16% 46%;

    --destructive: 0 72% 50%;
    --destructive-foreground: 0 85% 97%;

    --border: 212 26% 83%;
    --input: 212 26% 83%;
    --ring: 216 19% 26%;

    --radius: 0.625rem;

    --sidebar-background: 0 0% 98%;

    --sidebar-foreground: 222 47% 11%;

    --sidebar-primary: 216 19% 26%;

    --sidebar-primary-foreground: 210 19% 98%;

    --sidebar-accent: 215 19% 34%;

    --sidebar-accent-foreground: 210 40% 98%;

    --sidebar-border: 212 26% 83%;

    --sidebar-ring: 216 19% 26%;

    --chart-1: 217 10% 64%;

    --chart-2: 215 20% 65%;

    --chart-3: 215 16% 46%;

    --chart-4: 219 8% 46%;

    --chart-5: 215 19% 34%;

    --sidebar: 210 40% 98%;

    --font-sans: 'Geist', ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif;

    --font-serif: 'Crimson Pro', ui-serif, Georgia, Cambria, 'Times New Roman', Times, serif;

    --font-mono: 'JetBrains Mono', 'SF Mono', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;

    --shadow-2xs: 0 1px 3px 0px hsl(0 0% 0% / 0.05);

    --shadow-xs: 0 1px 3px 0px hsl(0 0% 0% / 0.05);

    --shadow-sm: 0 1px 3px 0px hsl(0 0% 0% / 0.1), 0 1px 2px -1px hsl(0 0% 0% / 0.1);

    --shadow: 0 1px 3px 0px hsl(0 0% 0% / 0.1), 0 1px 2px -1px hsl(0 0% 0% / 0.1);

    --shadow-md: 0 1px 3px 0px hsl(0 0% 0% / 0.1), 0 2px 4px -1px hsl(0 0% 0% / 0.1);

    --shadow-lg: 0 1px 3px 0px hsl(0 0% 0% / 0.1), 0 4px 6px -1px hsl(0 0% 0% / 0.1);

    --shadow-xl: 0 1px 3px 0px hsl(0 0% 0% / 0.1), 0 8px 10px -1px hsl(0 0% 0% / 0.1);

    --shadow-2xl: 0 1px 3px 0px hsl(0 0% 0% / 0.25);

    --tracking-normal: 0em;

    --spacing: 0.25rem;
  }

  .dark {
    /* Canvas & Base — premium navy (#0F172A) */
    --background: 222 47% 11%;
    --foreground: 210 20% 98%;

    /* Node cards — elevated surface (#111827) */
    --card: 220 26% 12%;
    --card-foreground: 210 20% 98%;

    /* Popovers / dropdowns (#1F2937) */
    --popover: 215 28% 17%;
    --popover-foreground: 210 20% 98%;

    /* Blue accent (#60A5FA) */
    --primary: 217 91% 68%;
    --primary-foreground: 222 47% 11%;

    /* Active surfaces (#1F2937) */
    --secondary: 215 28% 17%;
    --secondary-foreground: 210 20% 98%;

    /* Metadata text (#94A3B8) */
    --muted: 215 16% 47%;
    --muted-foreground: 215 16% 65%;

    /* Accent surfaces (#1F2937) */
    --accent: 215 28% 17%;
    --accent-foreground: 210 20% 98%;

    --destructive: 0 84% 60%;
    --destructive-foreground: 0 85% 97%;

    /* Borders — visible but subtle */
    --border: 215 20% 25%;
    --input: 215 20% 25%;
    --ring: 217 91% 68%;

    /* Sidebar */
    --sidebar-background: 229 84% 5%;
    --sidebar-foreground: 210 20% 98%;
    --sidebar-primary: 217 91% 68%;
    --sidebar-primary-foreground: 222 47% 11%;
    --sidebar-accent: 215 28% 17%;
    --sidebar-accent-foreground: 210 20% 98%;
    --sidebar-border: 215 20% 25%;
    --sidebar-ring: 217 91% 68%;

    /* Charts */
    --chart-1: 215 14% 91%;
    --chart-2: 217 91% 68%;
    --chart-3: 215 16% 65%;
    --chart-4: 217 10% 64%;
    --chart-5: 224 76% 40%;

    --sidebar: 220 26% 12%;

    /* Stronger dark shadows for depth */
    --shadow-2xs: 0 1px 3px 0px hsl(0 0% 0% / 0.1);
    --shadow-xs: 0 1px 3px 0px hsl(0 0% 0% / 0.15);
    --shadow-sm: 0 2px 6px 0px hsl(0 0% 0% / 0.2), 0 1px 2px -1px hsl(0 0% 0% / 0.15);
    --shadow: 0 4px 12px 0px hsl(0 0% 0% / 0.25), 0 1px 3px -1px hsl(0 0% 0% / 0.15);
    --shadow-md: 0 6px 18px 0px hsl(0 0% 0% / 0.3), 0 2px 6px -1px hsl(0 0% 0% / 0.2);
    --shadow-lg: 0 8px 24px 0px hsl(0 0% 0% / 0.35), 0 4px 8px -1px hsl(0 0% 0% / 0.2);
    --shadow-xl: 0 12px 32px 0px hsl(0 0% 0% / 0.4), 0 8px 12px -1px hsl(0 0% 0% / 0.2);
    --shadow-2xl: 0 16px 48px 0px hsl(0 0% 0% / 0.5);
  }
}

@layer base {
  * {
    @apply border-border;
  }

  body {
    @apply bg-background text-foreground antialiased;
    font-feature-settings: "cv02", "cv03", "cv04", "cv11";
  }

  *:focus-visible {
    @apply outline-none ring-2 ring-ring/40 ring-offset-2 ring-offset-background;
  }
}

@layer utilities {
  .glow-border {
    @apply relative;
    transition: box-shadow 0.3s ease;
  }

  .glow-border:hover {
    box-shadow: 0 0 30px -5px hsl(var(--primary) / 0.15),
      0 0 10px -5px hsl(var(--primary) / 0.1);
  }

  .dark .glow-border:hover {
    box-shadow: 0 0 40px -5px hsl(var(--primary) / 0.25),
      0 0 15px -5px hsl(var(--primary) / 0.2);
  }
}

/* ══════════════════════════════════════════════════════
   React Flow — Dark Mode Overrides
   ══════════════════════════════════════════════════════ */

/* ── Controls ── */
.dark .react-flow__controls {
  background: #020617;
  border: 1px solid rgba(148, 163, 184, 0.15);
  border-radius: 0.5rem;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
}

.dark .react-flow__controls button {
  background: transparent;
  border-bottom: 1px solid rgba(148, 163, 184, 0.12);
  color: #E5E7EB;
  fill: #E5E7EB;
}

.dark .react-flow__controls button:hover {
  background: rgba(148, 163, 184, 0.08);
}

.dark .react-flow__controls button svg {
  fill: #E5E7EB;
}

/* ── Handles ── */
.dark .react-flow__handle {
  background: #60A5FA;
  border-color: rgba(148, 163, 184, 0.25);
}

/* ── MiniMap ── */
.dark .react-flow__minimap {
  background: #020617;
  border: 1px solid rgba(148, 163, 184, 0.15);
  border-radius: 0.375rem;
}

/* ── Attribution / Watermark ── */
.react-flow__attribution {
  background: transparent !important;
  border: none !important;
}

.react-flow__attribution a {
  color: rgba(148, 163, 184, 0.4) !important;
}

/* ══════════════════════════════════════════════════════
   React Flow — Interaction & Transition
   ══════════════════════════════════════════════════════ */

/* Node base — transform transition intentionally omitted for drag performance */

/* Responsive minimap — smaller on mobile only */
@media (max-width: 767px) {
  .react-flow__minimap {
    width: 120px !important;
    height: 80px !important;
  }

  /* Prevent browser gestures on the canvas — isolate pinch-zoom to React Flow */
  .react-flow {
    touch-action: none;
  }

  /* Use dynamic viewport height to account for mobile address bar */
  .visualize-root {
    height: 100vh;
    /* fallback */
    height: 100dvh;
    /* modern: accounts for dynamic address bar */
    overflow: hidden;
  }
}

/* Subtle hover glow on nodes */
.react-flow__node:hover {
  filter: drop-shadow(0 0 8px rgba(96, 165, 250, 0.2));
}

/* Edge defaults in dark mode */
.dark .react-flow__edge-path {
  stroke-width: 2;
}

/* Edge hover feedback */
.react-flow__edge:hover .react-flow__edge-path {
  stroke-width: 3 !important;
  stroke: #60A5FA !important;
  filter: drop-shadow(0 0 12px rgba(96, 165, 250, 0.6));
}

/* Background grid dots */
.dark .react-flow__background pattern circle,
.dark .react-flow__background pattern rect {
  fill: rgba(148, 163, 184, 0.12) !important;
}

/* Selected node focus */
.dark .react-flow__node.selected>div {
  outline: 2px solid #60A5FA;
  outline-offset: 1px;
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.35);
}

/* Hide selection box for Diamond nodes */
.react-flow__node-erRelationship.selected>div,
.react-flow__node-erRelationship.selected:hover>div {
  outline: none !important;
  box-shadow: none !important;
  border-color: #60A5FA !important;
  /* Keep border color change to indicate selection, but no box */
}

/* ══════════════════════════════════════════════════════
   ER Legend Interaction Styles
   ══════════════════════════════════════════════════════ */

/* Base transitions for smooth dimming */
.react-flow__node,
.react-flow__edge,
.er-relationship-shape {
  transition: opacity 0.3s ease, filter 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
}

/* 1. Entity Highlight */
.legend-highlight-entity .react-flow__node:not(.react-flow__node-erEntity),
/* 1. Entity Highlight */
.legend-highlight-entity .react-flow__node:not(.react-flow__node-erEntity),
.legend-highlight-entity .react-flow__edge {
  opacity: 0.15;
}

.legend-highlight-entity .react-flow__node-erEntity>div {
  border-color: #60A5FA !important;
  border-width: 3px !important;
  box-shadow: none !important;
  transform: scale(1.02);
}

/* 2. Relationship Highlight */
.legend-highlight-relationship .react-flow__node:not(.react-flow__node-erRelationship),
.legend-highlight-relationship .react-flow__edge {
  opacity: 0.15;
}

.legend-highlight-relationship .er-relationship-shape {
  border-color: #60A5FA !important;
  border-width: 3px !important;
  box-shadow: none !important;
  transform: rotate(45deg) scale(1.05) !important;
}

/* 3. Attribute Highlight */
.legend-highlight-attribute .react-flow__node:not(.react-flow__node-erAttribute),
.legend-highlight-attribute .react-flow__edge {
  opacity: 0.15;
}

.legend-highlight-attribute .react-flow__node-erAttribute>div {
  border-color: #60A5FA !important;
  border-width: 3px !important;
  box-shadow: none !important;
  transform: scale(1.05);
}

/* 4. PK Highlight */
.legend-highlight-pk .react-flow__node:not(:has([data-pk="true"])),
.legend-highlight-pk .react-flow__edge {
  opacity: 0.15;
}

.legend-highlight-pk .react-flow__node:has([data-pk="true"])>div {
  border-color: #60A5FA !important;
  border-width: 3px !important;
  box-shadow: none !important;
  transform: scale(1.1);
}

/* 5. Cardinality 1 Highlight */
.legend-highlight-cardinality-1 .react-flow__node,
.legend-highlight-cardinality-1 .react-flow__edge:not(.edge-cardinality-1) {
  opacity: 0.15;
}

.legend-highlight-cardinality-1 .edge-cardinality-1 .react-flow__edge-path {
  stroke: #60A5FA !important;
  stroke-width: 3px !important;
  filter: drop-shadow(0 0 8px rgba(96, 165, 250, 0.6));
}

.legend-highlight-cardinality-1 .edge-cardinality-1 {
  opacity: 1 !important;
}

/* 6. Cardinality N Highlight */
.legend-highlight-cardinality-n .react-flow__node,
.legend-highlight-cardinality-n .react-flow__edge:not(.edge-cardinality-n) {
  opacity: 0.15;
}

.legend-highlight-cardinality-n .edge-cardinality-n .react-flow__edge-path {
  stroke: #60A5FA !important;
  stroke-width: 3px !important;
  filter: drop-shadow(0 0 8px rgba(96, 165, 250, 0.6));
}

.legend-highlight-cardinality-n .edge-cardinality-n {
  opacity: 1 !important;
}